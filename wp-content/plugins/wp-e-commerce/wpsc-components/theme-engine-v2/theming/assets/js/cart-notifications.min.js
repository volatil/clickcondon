/** WP eCommerce - v4.0.0 - 2017-03-15 | https://wpecommerce.org/ | Copyright (c) 2017; | Licensed GPLv2+ **/
!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";!function(window,document,$,notifs,undefined){var $id=function(id){return $(document.getElementById(id))},log=function log(){log.history=log.history||[],log.history.push(arguments),notifs.debug&&window.console&&window.console.log&&window.console.log(Array.prototype.slice.call(arguments))};notifs.currency=require("./utils/currency.js")(notifs.currency),notifs.models={Product:require("./models/product.js")(notifs),Status:require("./models/status.js")(notifs.currency,notifs.strings)},notifs.collections={Products:require("./collections/products.js")(notifs)},notifs.views={ProductRow:require("./views/product-row.js")(log,notifs)},notifs.views.Cart=require("./views/cart.js")({currency:notifs.currency,statusModel:notifs.models.Status,initialStatus:notifs.CartView.status,rowView:notifs.views.ProductRow},$id,log),notifs.init=function(){$(document.body).on("click",".wpsc-add-to-cart",notifs.clickAddProductToCart).on("click","#wpsc-modal-overlay",notifs.closeModal).on("click","#wpsc-view-cart-button",notifs.openModal).append($id("tmpl-wpsc-modal").html()),$(document).on("keydown",function(evt){27===evt.which&&notifs.closeModal()}),notifs.CartView=new notifs.views.Cart({collection:new notifs.collections.Products(notifs.CartView.items)})},notifs.clickAddProductToCart=function(evt){var $productForm=null,$this=$(this),$product=$this.parents(".wpsc-product");evt.preventDefault(),$product.length||($productForm=$this.parents(".wpsc-add-to-cart-form"),$productForm.length&&($product=$id("product-"+$productForm.data("id")))),$product.length&&notifs.addProductToCart($product,$productForm)},notifs.addProductToCart=function($product,$productForm){notifs.domToModel=notifs.domToModel||require("./utils/product-dom-to-model.js")(notifs.currency),notifs.CartView.trigger("add-to-cart",notifs.domToModel.prepare($product,$productForm))},notifs.closeModal=function(){notifs.CartView.trigger("close")},notifs.openModal=function(){notifs.CartView.trigger("open")},$(notifs.init)}(window,document,jQuery,window.WPSC.cartNotifications)},{"./collections/products.js":2,"./models/product.js":3,"./models/status.js":4,"./utils/currency.js":5,"./utils/product-dom-to-model.js":6,"./views/cart.js":7,"./views/product-row.js":8}],2:[function(require,module,exports){"use strict";module.exports=function(notifs){return Backbone.Collection.extend({model:notifs.models.Product,url:notifs.baseRoute+"/cart",getById:function(id){return id=parseInt(id,10),this.find(function(model){return model.get("id")===id})},totalPrice:function(){return this.reduce(function(memo,model){return memo+model.getTotal()},0).toFixed(2)}})}},{}],3:[function(require,module,exports){"use strict";module.exports=function(notifs){return Backbone.Model.extend({defaults:{id:0,nonce:"",deleteNonce:"",url:"",price:"",formattedPrice:"",title:"",thumb:"",quantity:0,remove_url:"",variations:[],editQty:!1,action:""},getTotal:function(){return this.get("price")*parseInt(this.get("quantity"),10)},get:function(attribute){var value=Backbone.Model.prototype.get.call(this,attribute);switch(attribute){case"id":case"quantity":value=parseInt(value,10);break;case"price":value=parseFloat(value).toFixed(2);break;case"formattedPrice":value=notifs.currency.format(this.get("price"));break;case"variations":break;case"editQty":value=Boolean(value);break;default:value=value.trim()}return value},sync:function(method,model,options){var beforeSend;options=options||{},options.url=model.url(),"update"===method&&("quantity"in model.changed?options.url=this.addQueryVar(options.url,"quantity",encodeURIComponent(this.get("quantity"))):(options.url=model.collection.url,options.url+="/add/"+encodeURIComponent(this.get("id"))));var nonce="delete"===method?this.get("deleteNonce"):this.get("nonce");return options.url=this.addQueryVar(options.url,"_wp_nonce",encodeURIComponent(nonce)),_.isUndefined(notifs.apiNonce)||_.isNull(notifs.apiNonce)||(beforeSend=options.beforeSend,options.beforeSend=function(xhr){if(xhr.setRequestHeader("X-WP-Nonce",notifs.apiNonce),beforeSend)return beforeSend.apply(this,arguments)}),Backbone.sync(method,model,options)},addQueryVar:function(uri,key,value){var re=new RegExp("([?&])"+key+"=.*?(&|$)","i");return uri.match(re)?uri.replace(re,"$1"+key+"="+value+"$2"):uri+(-1!==uri.indexOf("?")?"&":"?")+key+"="+value}})}},{}],4:[function(require,module,exports){"use strict";module.exports=function(currency,strings){return Backbone.Model.extend({sync:function(){return!1},defaults:{status:"closed",action:"added",actionText:strings.status_added,actionIcon:"wpsc-icon-check",countClass:"",view:"expanded",total:0,formattedTotal:0,subTotal:0,shippingTotal:0,numberChanged:1,numberItems:0},_get:function(value,attribute){var action;switch(attribute){case"countClass":value="none"===this.get("action")?"wpsc-hide":this.defaults.countClass;break;case"actionText":action=this.get("action"),value=strings["status_"+action]?strings["status_"+action]:this.defaults.actionText;break;case"formattedTotal":value=currency.format(this.get("total"));break;case"actionIcon":switch(this.get("action")){case"removed":value="wpsc-icon-remove-sign";break;case"none":value="wpsc-hide";break;default:value=this.defaults.actionIcon}}return value},get:function(attribute){return this._get(Backbone.Model.prototype.get.call(this,attribute),attribute)},toJSON:function(){return _.mapObject(Backbone.Model.prototype.toJSON.call(this),_.bind(this._get,this))}})}},{}],5:[function(require,module,exports){"use strict";module.exports=function(l10n){var currency={l10n:l10n,template:!1};return currency.format=function(amt){return amt=currency.numberFormat(amt,l10n.decimals,l10n.decimalSep,l10n.thousandsSep),currency.template||(currency.template=wp.template("wpsc-currency-format")),currency.template({code:l10n.code,symbol:l10n.symbol,amount:amt}).trim()},currency.deformat=function(formatted){var amount=formatted.replace(l10n.decimalSep,".").replace("-","").replace(l10n.thousandsSep,"").replace(l10n.code,"").replace(l10n.symbol,"");return parseFloat(amount).toFixed(2)},currency.numberFormat=function(number,decimals,decSep,thouSep){number=(number+"").replace(/[^0-9+\-Ee.]/g,"");var n=isFinite(+number)?+number:0,prec=isFinite(+decimals)?Math.abs(decimals):0,sep=void 0===thouSep?",":thouSep,dec=void 0===decSep?".":decSep,s="";return s=(prec?function(n,prec){var k=Math.pow(10,prec);return""+(Math.round(n*k)/k).toFixed(prec)}(n,prec):""+Math.round(n)).split("."),s[0].length>3&&(s[0]=s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,sep)),(s[1]||"").length<prec&&(s[1]=s[1]||"",s[1]+=new Array(prec-s[1].length+1).join("0")),s.join(dec)},currency}},{}],6:[function(require,module,exports){"use strict";module.exports=function(currency){var getVariationsFromProductForm=function($productForm){var $variations=$productForm.find('[name^="wpsc_product_variations"]'),variations=[];return $variations.length?($variations.each(function(){var variationValue,$selected,$selectedLabel,$variation=jQuery(this),$variationLabel=$productForm.find('label[for="'+$variation.attr("id")+'"]');switch($variation[0].tagName){case"RADIO":$selected=$variation.find('[value="'+$variation.val()+'"]'),$selectedLabel=$selected.length?$productForm.find('label[for="'+$selected.attr("id")+'"]').text():[],$selectedLabel.length&&(variationValue=$selectedLabel.text());break;case"SELECT":$selected=$variation.find('[value="'+$variation.val()+'"]'),$selected.length&&(variationValue=$selected.text());break;default:variationValue=$variation.val()}variations.push({label:$variationLabel.length?$variationLabel.text():"",value:variationValue})}),variations):variations};return{prepare:function($product,$productForm){$productForm=$productForm&&$productForm.length?$productForm:$product.find(".wpsc-add-to-cart-form");var nonce=$productForm.find('[name="_wp_nonce"]').val(),$thumb=$product.find(".wpsc-product-thumbnail"),$salePrice=$product.find(".wpsc-product-price .wpsc-sale-price .wpsc-amount"),price=$salePrice.length?$salePrice.text():$product.find(".wpsc-product-price .wpsc-amount").last().text();return{id:$productForm.data("id"),nonce:nonce,url:$thumb.length?$thumb.attr("href"):$product.find(".wpsc-product-title > a").attr("href"),price:currency.deformat(price),formattedPrice:price,title:$product.find(".wpsc-product-title > a").text(),thumb:$thumb.length?$thumb.html():"",quantity:$productForm.find('[name="quantity"]').val(),remove_url:"",variations:getVariationsFromProductForm($productForm)}}}}},{}],7:[function(require,module,exports){"use strict";module.exports=function(args,$id,log){return Backbone.View.extend({el:"#wpsc-cart-notification",$btn:"",$overlay:"",template:wp.template("wpsc-modal-inner"),status:{},events:{"click .wpsc-close-modal":"clickClose","click .wpsc-cart-view-toggle i":"clickToggleView"},initialize:function(){this.$btn=$id("wpsc-view-cart-button"),this.$overlay=$id("wpsc-modal-overlay"),this.status=new args.statusModel(args.initialStatus),this.status.set("numberItems",this.collection.length),this.status.set("numberChanged",this.collection.length),this.listenTo(this.collection,"remove",this.checkEmpty),this.listenTo(this.collection,"add remove",this.updateStatusandRender),this.listenTo(this.collection,"render",this.render),this.listenTo(this.collection,"change:quantity",this.setTotal),this.listenTo(this.collection,"change:editQty",this.calculateHeight),this.listenTo(this.collection,"error",this.handleError),this.listenTo(this.status,"change",this.maybeUpdateView),this.listenTo(this,"open",this.renderNoAction),this.listenTo(this,"close",this.close),this.listenTo(this,"add-to-cart",this.maybeAdd),this.renderNoShow()},handleError:function(errorObject){log("Collection handleError",errorObject)},renderNoAction:function(){this.status.set("action","none"),this.render()},renderNoShow:function(){return this.$el.html(this.template(this.status.toJSON())).find(".wpsc-cart-body").html(this._getProducts()),this},render:function(){return this.renderNoShow(),this.$overlay.removeClass("wpsc-hide"),this.status.set("status","open"),this.calculateHeight(),this},calculateHeight:function(){var newHeight=this.$el.removeClass("wpsc-hide").removeClass("wpsc-cart-set-height").find(".wpsc-cart-notification-inner").outerHeight(),winHeight=jQuery(window).height(),maxHeight=winHeight-.3*winHeight;newHeight>maxHeight?(newHeight=maxHeight,this.$el.addClass("wpsc-overflow")):this.$el.removeClass("wpsc-overflow"),this.$el.height(Math.round(newHeight)).addClass("wpsc-cart-set-height")},_getProducts:function(){var productNodes=document.createDocumentFragment();return this.collection.each(function(model){var row=new args.rowView({model:model});productNodes.appendChild(row.render().el)}),productNodes},checkEmpty:function(){this.collection.length||this.close()},maybeUpdateView:function(statusChanged){this.collection.length>0&&(statusChanged.changed.view||statusChanged.changed.total)&&this.render()},close:function(){this.status.set("status","closed"),this.collection.trigger("closeModal"),this.$overlay.addClass("wpsc-hide"),this.$el.addClass("wpsc-hide")},updateStatusandRender:function(){var prevNumber=this.status.get("numberItems"),numberChanged=this.collection.length-prevNumber;this.status.set("action",numberChanged<0?"removed":"added"),numberChanged=Math.abs(numberChanged),numberChanged=numberChanged<1?1:numberChanged,this.status.set("numberChanged",numberChanged),this.status.set("numberItems",this.collection.length),this.setTotal(),this.$btn[this.collection.length?"removeClass":"addClass"]("wpsc-hide")},setTotal:function(){this.status.set("total",this.collection.totalPrice())},maybeAdd:function(data){var model=this.collection.getById(data.id);if(model){var qty=Math.round(parseInt(model.get("quantity"),10)+parseInt(data.quantity,10));model.set("quantity",qty),this.setTotal()}else model=this.collection.create(data);return model},clickClose:function(evt){evt.preventDefault(),this.close()},clickToggleView:function(evt){evt.preventDefault(),this.status.set("view",jQuery(evt.target).data("view"))}})}},{}],8:[function(require,module,exports){"use strict";module.exports=function(log,notifs){return Backbone.View.extend({$quantity:null,template:wp.template("wpsc-modal-product"),tagName:"div",id:function(){return"wpsc-modal-cart-item-"+this.model.get("id")},className:function(){var thumbClass=this.model.get("thumb")?"":"no-";return"wpsc-cart-item wpsc-cart-item-"+this.model.get("id")+" wpsc-cart-"+thumbClass+"thumb"},events:{"click .wpsc-cart-item-edit":"editQty","click .wpsc-cart-item-remove":"maybeRemoveIt","click .wpsc-qty-button":"modifyQty","change .modify-cart-quantity":"quantityChanged"},initialize:function(){this.listenTo(this.model,"change:price",this.render),this.listenTo(this.model,"change:formattedPrice",this.render),this.listenTo(this.model,"change:editQty",this.render),this.listenTo(this.model.collection,"closeModal",this.hideQty),this.listenTo(this,"error",this.handleError)},handleError:function(errorObject){log("Model handleError",errorObject)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this},editQty:function editQty(evt){evt.preventDefault();var editQty=this.model.get("editQty");this.model.set("editQty",!editQty)},hideQty:function(){this.model.set("editQty",!1)},quantityChanged:function(evt){var $input=this.$(".modify-cart-quantity"),qty=$input.val();if(qty<1){if(this.maybeRemoveIt(evt))return;qty=1,$input.val(qty)}this.model.save({quantity:qty})},maybeRemoveIt:function(evt){return!!window.confirm(notifs.strings.sure_remove)&&(this.removeIt(evt),!0)},removeIt:function(evt){evt.preventDefault();var _this=this,destroyError=function(model,response){log("destroyError",response),_this.$el.fadeIn(300)},destroySuccess=function(model,response){response.id?(log("destroySuccess",response),_this.$el.remove()):destroyError(0,response)};return _this.$el.fadeOut(300),this.model.destroy({success:destroySuccess,error:destroyError,wait:!0}),!0},modifyQty:function(evt){var $button=this.$(evt.currentTarget),$input=$button.parent().find("input"),oldVal=parseInt($input.val(),10),newVal=oldVal+1;"-"===$button.text()&&(newVal=oldVal>0?oldVal-1:0),$input.val(newVal).trigger("change")}})}},{}]},{},[1]);