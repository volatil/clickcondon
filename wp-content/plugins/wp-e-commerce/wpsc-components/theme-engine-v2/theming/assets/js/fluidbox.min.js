/** WP eCommerce - v4.0.0 - 2017-03-12 | https://wpecommerce.org/ | Copyright (c) 2017; | Licensed GPLv2+ **/
!function($,window,document,_,undefined){"use strict";function Plugin(element,options){this.element=element;var elementData={};$.each($(this.element).data(),function(k,v){var key=function(s){return s&&s[0].toLowerCase()+s.slice(1)}(k.replace("fluidbox",""));""===key&&null===key||(v="false"!==v,elementData[key]=v)}),this.settings=$.extend({},defaults,options,elementData),this.settings.viewportFill=Math.max(Math.min(parseFloat(this.settings.viewportFill),1),0),this.settings.stackIndex<this.settings.stackIndexDelta&&(this.settings.stackIndexDelta=this.settings.stackIndex),this._name=pluginName,this.init()}var $w=$(window),pluginName=($(document),"fluidbox"),defaults={immediateOpen:!1,loader:!1,maxWidth:0,maxHeight:0,resizeThrottle:500,stackIndex:1e3,stackIndexDelta:10,viewportFill:.95},globalData={},fbInstance=0;"undefined"!=typeof console&&"undefined"!==console.warn||(console={},console.warn=function(){});var customTransitionEnd=function(){var t,el=document.createElement("fakeelement"),transitions={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(t in transitions)if(void 0!==el.style[t])return transitions[t]}(),_fun={dom:function(){var $fb_innerWrap=$("<div />",{class:"fluidbox__wrap",css:{zIndex:this.settings.stackIndex-this.settings.stackIndexDelta}});if($(this.element).addClass("fluidbox--closed").wrapInner($fb_innerWrap).find("img").first().css({opacity:1}).addClass("fluidbox__thumb").after('<div class="fluidbox__ghost" />'),this.settings.loader){var $fbLoader=$("<div />",{class:"fluidbox__loader",css:{zIndex:2}});$(this.element).find(".fluidbox__wrap").append($fbLoader)}},prepareFb:function(){var fb=this,$fb=$(this.element);$fb.trigger("thumbloaddone.fluidbox"),_fun.measure.fbElements.call(this),fb.bindEvents(),$fb.addClass("fluidbox--ready"),fb.bindListeners(),$fb.trigger("ready.fluidbox")},measure:{viewport:function(){globalData.viewport={w:$w.width(),h:$w.height()}},fbElements:function(){var fb=this,$fb=$(this.element),$fbThumb=$fb.find("img").first(),$fbGhost=$fb.find(".fluidbox__ghost"),$fbWrap=$fb.find(".fluidbox__wrap");fb.instanceData.thumb={natW:$fbThumb[0].naturalWidth,natH:$fbThumb[0].naturalHeight,w:$fbThumb.width(),h:$fbThumb.height()},$fbGhost.css({width:$fbThumb.width(),height:$fbThumb.height(),top:$fbThumb.offset().top-$fbWrap.offset().top+parseInt($fbThumb.css("borderTopWidth"),10)+parseInt($fbThumb.css("paddingTop"),10),left:$fbThumb.offset().left-$fbWrap.offset().left+parseInt($fbThumb.css("borderLeftWidth"),10)+parseInt($fbThumb.css("paddingLeft"),10)})}},checkURL:function(url){var exitCode=0;return/[\s+]/g.test(url)?(console.warn("Fluidbox: Fluidbox opening is halted because it has detected characters in your URL string that need to be properly encoded/escaped. Whitespace(s) have to be escaped manually. See RFC3986 documentation."),exitCode=1):/[\"\'\(\)]/g.test(url)&&(console.warn("Fluidbox: Fluidbox opening will proceed, but it has detected characters in your URL string that need to be properly encoded/escaped. These will be escaped for you. See RFC3986 documentation."),exitCode=0),exitCode},formatURL:function(url){return url.replace(/"/g,"%22").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")}};$.extend(Plugin.prototype,{init:function(){var fb=this,$fb=$(this.element),$fbThumb=$fb.find("img").first();if(_fun.measure.viewport(),(!fb.instanceData||!fb.instanceData.initialized)&&$fb.is("a")&&1===$fb.children().length&&($fb.children().is("img")||$fb.children().is("picture")&&1===$fb.find("img").length)&&"none"!==$fb.css("display")&&"none"!==$fb.children().css("display")&&"none"!==$fb.parents().css("display")){$fb.removeClass("fluidbox--destroyed"),fb.instanceData={},fb.instanceData.initialized=!0,fb.instanceData.originalNode=$fb.html(),fbInstance+=1,fb.instanceData.id=fbInstance,$fb.addClass("fluidbox__instance-"+fbInstance),$fb.addClass("fluidbox--initialized"),_fun.dom.call(fb),$fb.trigger("init.fluidbox");var img=new Image;$fbThumb.width()>0&&$fbThumb.height()>0?_fun.prepareFb.call(fb):(img.onload=function(){_fun.prepareFb.call(fb)},img.onerror=function(){$fb.trigger("thumbloadfail.fluidbox")},img.src=$fbThumb.attr("src"))}},open:function(){var fb=this,$fb=$(this.element),$fbThumb=$fb.find("img").first(),$fbGhost=$fb.find(".fluidbox__ghost"),$fbWrap=$fb.find(".fluidbox__wrap");fb.instanceData.state=1,$fbGhost.off(customTransitionEnd),$(".fluidbox--opened").fluidbox("close");var $fbOverlay=$("<div />",{class:"fluidbox__overlay",css:{zIndex:-1}});if($fbWrap.append($fbOverlay),$fb.removeClass("fluidbox--closed").addClass("fluidbox--loading"),_fun.checkURL($fbThumb.attr("src")))return fb.close(),!1;$fbGhost.css({"background-image":"url("+_fun.formatURL($fbThumb.attr("src"))+")",opacity:1}),_fun.measure.fbElements.call(fb);var img;fb.settings.immediateOpen?($fb.addClass("fluidbox--opened fluidbox--loaded").find(".fluidbox__wrap").css({zIndex:fb.settings.stackIndex+fb.settings.stackIndexDelta}),$fb.trigger("openstart.fluidbox"),fb.compute(),$fbThumb.css({opacity:0}),$(".fluidbox__overlay").css({opacity:1}),$fbGhost.one(customTransitionEnd,function(){$fb.trigger("openend.fluidbox")}),img=new Image,img.onload=function(){if(1===fb.instanceData.state){if(fb.instanceData.thumb.natW=img.naturalWidth,fb.instanceData.thumb.natH=img.naturalHeight,$fb.removeClass("fluidbox--loading"),_fun.checkURL(img.src))return fb.close(),!1;$fbGhost.css({"background-image":"url("+_fun.formatURL(img.src)+")"}),fb.compute()}},img.onerror=function(){fb.close(),$fb.trigger("imageloadfail.fluidbox"),$fb.trigger("delayedloadfail.fluidbox")},img.src=$fb.attr("href")):(img=new Image,img.onload=function(){if($fb.removeClass("fluidbox--loading").addClass("fluidbox--opened fluidbox--loaded").find(".fluidbox__wrap").css({zIndex:fb.settings.stackIndex+fb.settings.stackIndexDelta}),$fb.trigger("openstart.fluidbox"),_fun.checkURL(img.src))return fb.close(),!1;$fbGhost.css({"background-image":"url("+_fun.formatURL(img.src)+")"}),fb.instanceData.thumb.natW=img.naturalWidth,fb.instanceData.thumb.natH=img.naturalHeight,fb.compute(),$fbThumb.css({opacity:0}),$(".fluidbox__overlay").css({opacity:1}),$fbGhost.one(customTransitionEnd,function(){$fb.trigger("openend.fluidbox")})},img.onerror=function(){fb.close(),$fb.trigger("imageloadfail.fluidbox")},img.src=$fb.attr("href"))},compute:function(){var fb=this,$fb=$(this.element),$fbThumb=$fb.find("img").first(),$fbGhost=$fb.find(".fluidbox__ghost"),$fbWrap=$fb.find(".fluidbox__wrap"),imgNatW=fb.instanceData.thumb.natW,imgNatH=fb.instanceData.thumb.natH,imgW=fb.instanceData.thumb.w,imgH=fb.instanceData.thumb.h,thumbRatio=imgNatW/imgNatH,viewportRatio=globalData.viewport.w/globalData.viewport.h;fb.settings.maxWidth>0?(imgNatW=fb.settings.maxWidth,imgNatH=imgNatW/thumbRatio):fb.settings.maxHeight>0&&(imgNatH=fb.settings.maxHeight,imgNatW=imgNatH*thumbRatio);var computedHeight,computedWidth,imgScaleY,imgScaleX,imgMinScale;viewportRatio>thumbRatio?(computedHeight=imgNatH<globalData.viewport.h?imgNatH:globalData.viewport.h*fb.settings.viewportFill,imgScaleY=computedHeight/imgH,imgScaleX=imgNatW*(imgH*imgScaleY/imgNatH)/imgW,imgMinScale=imgScaleY):(computedWidth=imgNatW<globalData.viewport.w?imgNatW:globalData.viewport.w*fb.settings.viewportFill,imgScaleX=computedWidth/imgW,imgScaleY=imgNatH*(imgW*imgScaleX/imgNatW)/imgH,imgMinScale=imgScaleX),fb.settings.maxWidth&&fb.settings.maxHeight&&console.warn("Fluidbox: Both maxHeight and maxWidth are specified. You can only specify one. If both are specified, only the maxWidth property will be respected. This will not generate any error, but may cause unexpected sizing behavior.");var offsetY=$w.scrollTop()-$fbThumb.offset().top+imgH*(imgMinScale-1)*.5+.5*($w.height()-imgH*imgMinScale),offsetX=imgW*(imgMinScale-1)*.5+.5*($w.width()-imgW*imgMinScale)-$fbThumb.offset().left,scale=parseInt(100*imgScaleX,10)/100+","+parseInt(100*imgScaleY,10)/100;$fbGhost.css({transform:"translate("+parseInt(100*offsetX,10)/100+"px,"+parseInt(100*offsetY,10)/100+"px) scale("+scale+")",top:$fbThumb.offset().top-$fbWrap.offset().top,left:$fbThumb.offset().left-$fbWrap.offset().left}),$fb.find(".fluidbox__loader").css({transform:"translate("+parseInt(100*offsetX,10)/100+"px,"+parseInt(100*offsetY,10)/100+"px) scale("+scale+")"}),$fb.trigger("computeend.fluidbox")},recompute:function(){this.compute()},close:function(){var fb=this,$fb=$(this.element),$fbThumb=$fb.find("img").first(),$fbGhost=$fb.find(".fluidbox__ghost"),$fbWrap=$fb.find(".fluidbox__wrap"),$fbOverlay=$fb.find(".fluidbox__overlay");if(null===fb.instanceData.state||void 0===fb.instanceData.state||0===fb.instanceData.state)return!1;fb.instanceData.state=0,$fb.trigger("closestart.fluidbox"),$fb.removeClass(function(i,c){return(c.match(/(^|\s)fluidbox--(opened|loaded|loading)+/g)||[]).join(" ")}).addClass("fluidbox--closed"),$fbGhost.css({transform:"translate(0,0) scale(1,1)",top:$fbThumb.offset().top-$fbWrap.offset().top+parseInt($fbThumb.css("borderTopWidth"),10)+parseInt($fbThumb.css("paddingTop"),10),left:$fbThumb.offset().left-$fbWrap.offset().left+parseInt($fbThumb.css("borderLeftWidth"),10)+parseInt($fbThumb.css("paddingLeft"),10)}),$fb.find(".fluidbox__loader").css({transform:"none"}),$fbGhost.one(customTransitionEnd,function(){$fbGhost.css({opacity:0}),$fbThumb.css({opacity:1}),$fbOverlay.remove(),$fbWrap.css({zIndex:fb.settings.stackIndex-fb.settings.stackIndexDelta}),$fb.trigger("closeend.fluidbox")}),$fbOverlay.css({opacity:0})},bindEvents:function(){var fb=this;$(this.element).on("click.fluidbox",function(e){e.preventDefault(),fb.instanceData.state&&0!==fb.instanceData.state?fb.close():fb.open()})},bindListeners:function(){var fb=this,$fb=$(this.element),resizeFunction=function(){_fun.measure.viewport(),_fun.measure.fbElements.call(fb),$fb.hasClass("fluidbox--opened")&&fb.compute()};$w.on("resize.fluidbox"+fb.instanceData.id,_.throttle(resizeFunction,fb.settings.resizeThrottle)),$fb.on("reposition.fluidbox",function(){fb.reposition()}),$fb.on("recompute.fluidbox, compute.fluidbox",function(){fb.compute()}),$fb.on("destroy.fluidbox",function(){fb.destroy()}),$fb.on("close.fluidbox",function(){fb.close()})},unbind:function(){$(this.element).off("click.fluidbox reposition.fluidbox recompute.fluidbox compute.fluidbox destroy.fluidbox close.fluidbox"),$w.off("resize.fluidbox"+this.instanceData.id)},reposition:function(){_fun.measure.fbElements.call(this)},destroy:function(){var originalNode=this.instanceData.originalNode;this.unbind(),$.data(this.element,"plugin_"+pluginName,null),$(this.element).removeClass(function(i,c){return(c.match(/(^|\s)fluidbox[--|__]\S+/g)||[]).join(" ")}).empty().html(originalNode).addClass("fluidbox--destroyed").trigger("destroyed.fluidbox")},getMetadata:function(){return this.instanceData}}),$.fn[pluginName]=function(options){var args=arguments;if(void 0===options||"object"==typeof options)return this.each(function(){$.data(this,"plugin_"+pluginName)||$.data(this,"plugin_"+pluginName,new Plugin(this,options))});if("string"==typeof options&&"_"!==options[0]&&"init"!==options){var returnVal;return this.each(function(){var instance=$.data(this,"plugin_"+pluginName);instance instanceof Plugin&&"function"==typeof instance[options]?returnVal=instance[options].apply(instance,Array.prototype.slice.call(args,1)):console.warn('Fluidbox: The method "'+options+'" used is not defined in Fluidbox. Please make sure you are calling the correct public method.')}),void 0!==returnVal?returnVal:this}return this}}(jQuery,window,document,_),function($,wpsc){$(".wpsc-product-thumbnail").fluidbox(wpsc)}(jQuery,WPSC_Fluid_Box_Options);